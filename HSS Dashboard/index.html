<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>HSS Dashboard</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>
<body>
    <div class="header">
        <h1>HSS Dashboard</h1>
        <button id="logoutBtn" class="logout-btn">Logout</button>
    </div>
    <div class="container">
        <h2>Alerts</h2>
        <div id="alerts"></div>
    </div>

    <script>
        // Firebase configuration (replace with your actual config)
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Protect route - redirect to login if not signed in
        auth.onAuthStateChanged(user => {
            if (!user) {
                window.location.href = "login.html";
            }
        });

        // Logout
        document.getElementById('logoutBtn').addEventListener('click', () => {
            auth.signOut();
        });

        // Load alerts with proper timestamp handling
        db.collection("alerts")
            .orderBy("timestamp", "desc")
            .onSnapshot(snapshot => {
                const alertsDiv = document.getElementById("alerts");
                alertsDiv.innerHTML = "";

                snapshot.forEach(doc => {
                    const data = doc.data();
                    let timeString = "No timestamp";

                    if (data.timestamp) {
                        // If Firestore Timestamp instance
                        if (typeof data.timestamp.toDate === "function") {
                            timeString = data.timestamp.toDate().toLocaleString();
                        }
                        // If it's a Firestore timestamp object with seconds/nanoseconds
                        else if (data.timestamp.seconds) {
                            timeString = new Date(data.timestamp.seconds * 1000).toLocaleString();
                        }
                        // If it's already a Date string
                        else if (typeof data.timestamp === "string" || typeof data.timestamp === "number") {
                            timeString = new Date(data.timestamp).toLocaleString();
                        }
                    }

                    alertsDiv.innerHTML += `
                        <div class="alert-item">
                            <strong>${data.zone || "Unknown Zone"}</strong> - ${data.status || "No Status"}
                            <br>
                            <small>${timeString}</small>
                        </div>
                        <hr>
                    `;
                });
            });
    </script>

    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
        }
        .header {
            background-color: #2196F3;
            color: white;
            padding: 15px;
            text-align: center;
            position: relative;
        }
        .logout-btn {
            background-color: #f44336;
            border: none;
            color: white;
            padding: 8px 12px;
            position: absolute;
            right: 20px;
            top: 15px;
            cursor: pointer;
            border-radius: 4px;
        }
        .container {
            background-color: white;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            border-radius: 8px;
        }
        .alert-item {
            padding: 5px 0;
        }
        hr {
            border: 0;
            border-top: 1px solid #ddd;
        }
    </style>
</body>
</html>
